<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Programação TV (mi.tv local)</title>
</head>
<body>
<script>
const urlParams = new URLSearchParams(location.search);
const canal = urlParams.get('canal') || ''; // ?canal=cinemax
function normalizar(t){
  return (t||'').toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/\s+/g,' ').trim();
}
function limpar(t){return (t||'').replace(/\s+/g,' ').trim();}

async function getProgramacao(){
  try {
    // Aqui usamos o arquivo salvo
    const resp = await fetch("Guia de Programação da televisão no Brasil - Hoje - mi.tv.html");
    if(!resp.ok) throw new Error(resp.status);
    const html = await resp.text();
    const doc = new DOMParser().parseFromString(html, "text/html");
    const canaisEls = doc.querySelectorAll("div.channel");
    const lista = [];
    const filtro = normalizar(canal);
    canaisEls.forEach(ch=>{
      const nome = limpar(ch.querySelector("h3")?.textContent || ch.querySelector("a.c")?.textContent);
      if(filtro && !normalizar(nome).includes(filtro)) return;
      const logo = ch.querySelector("img.logo")?.getAttribute("src") || "";
      ch.querySelectorAll("ul.broadcasts li").forEach(li=>{
        const hora = limpar(li.querySelector("span.time")?.textContent);
        const titulo = limpar(li.querySelector("span.title")?.textContent) || limpar(li.textContent).slice(0,80);
        const subtitulo = limpar(li.querySelector("span.sub-title")?.textContent);
        lista.push({canal:nome,logo,hora,titulo,subtitulo});
      });
    });
    document.body.textContent = JSON.stringify(lista,null,2);
  } catch(e){
    document.body.textContent = JSON.stringify({erro:e.message});
  }
}
getProgramacao();
</script>
</body>
</html>
