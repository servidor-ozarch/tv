<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>SPORTV - Ao vivo</title>
<style>
html, body {
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:system-ui,sans-serif;
}
#playerWrap {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100vh;
  z-index:100;
}
iframe {
  width:100%;
  height:100%;
  border:0;
}
#denied {
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:200;
  text-align:center;
}
canvas {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:1;
}
#deniedContent {
  position:relative;
  z-index:2;
  color:#fff;
  max-width:500px;
  padding:20px;
  border:2px solid #ff0000;
  border-radius:12px;
  background:rgba(0,0,0,0.7);
  box-shadow:0 0 20px rgba(255,0,0,0.7);
}
#deniedContent h1 {
  margin:0 0 10px 0;
  font-size:2em;
}
#deniedContent p {
  margin:0;
  font-size:1em;
}
</style>
</head>
<body>

<div id="denied">
  <canvas id="deniedCanvas"></canvas>
  <div id="deniedContent">
    <h1>⚠️ ACESSO NEGADO</h1>
    <p>Token inválido! Acompanhe os tokens gratuitos através do WhatsApp para os principais jogos.</p>
  </div>
</div>

<div id="playerWrap"></div>

<!-- Blocos SHA-1 do PLAYER -->
<div id="p1" class="hide">https</div>
<div id="p2" class="hide">://</div>
<div id="p3" class="hide">rdc</div>
<div id="p4" class="hide">play</div>
<div id="p5" class="hide">.live</div>
<div id="p6" class="hide">/prime/</div>
<div id="p7" class="hide">sportv</div>
<div id="p8" class="hide">.html</div>

<script>
(async function(){

  const params = new URLSearchParams(window.location.search);
  const tokenInput = (params.get('token')||'').trim();
  if(!tokenInput) return;

  const deniedEl = document.getElementById('denied');
  const playerWrap = document.getElementById('playerWrap');
  let iframeAdded = false;

  // Canvas animado
  const canvas = document.getElementById('deniedCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let particles = [];
  for(let i=0;i<80;i++){
    particles.push({
      x:Math.random()*canvas.width,
      y:Math.random()*canvas.height,
      vx:(Math.random()-0.5)*1.2,
      vy:(Math.random()-0.5)*1.2,
      size:Math.random()*3+1
    });
  }

  function drawParticles(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'rgba(255,0,0,0.8)';
    particles.forEach(p=>{
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
      ctx.fill();
      p.x += p.vx;
      p.y += p.vy;
      if(p.x<0)p.x=canvas.width;
      if(p.x>canvas.width)p.x=0;
      if(p.y<0)p.y=canvas.height;
      if(p.y>canvas.height)p.y=0;
    });
    requestAnimationFrame(drawParticles);
  }
  drawParticles();

  // Wake Lock
  let wakeLock = null;
  async function requestWakeLock() {
    try {
      if ('wakeLock' in navigator) {
        wakeLock = await navigator.wakeLock.request('screen');
        wakeLock.addEventListener('release', () => console.log('Wake Lock liberado'));
      }
    } catch (err) {
      console.error('Erro ao ativar Wake Lock:', err);
    }
  }
  requestWakeLock();
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') requestWakeLock();
  });

  async function sha1(str){
    const buf = new TextEncoder().encode(str);
    const hashBuffer = await crypto.subtle.digest("SHA-1", buf);
    return Array.from(new Uint8Array(hashBuffer))
                .map(b => b.toString(16).padStart(2,"0"))
                .join("");
  }

  function autoPlay() {
    const iframe = document.querySelector('iframe');
    if(!iframe) return;
    try {
      const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      const playButton = iframeDoc.querySelector('button[data-play]');
      if (playButton) playButton.click();
    } catch(e){ console.log('Não foi possível acessar iframe para autoplay', e); }
  }

  async function checkToken(){
    try {
      const FIREBASE_URL = "https://projeto-aplicativo-android-default-rtdb.firebaseio.com/Eliomar/token.json";
      const PROXY = "https://api.allorigins.win/raw?url=" + encodeURIComponent(FIREBASE_URL);

      const res = await fetch(PROXY + "?cachebust=" + Date.now());
      if(!res.ok) throw new Error("Falha ao ler token do Firebase");
      let tokenFromFirebase = await res.text();
      tokenFromFirebase = tokenFromFirebase.replace(/["\n\r]/g,"").trim();

      const tokenHash = await sha1(tokenInput);

      if(tokenInput === tokenFromFirebase || tokenHash === tokenFromFirebase){
        if(!iframeAdded){
          deniedEl.style.display = 'none';
          const playerOrder = ["p1","p2","p3","p4","p5","p6","p7","p8"];
          const PLAYER_URL = playerOrder.map(id=>document.getElementById(id).innerText).join("");
          const iframe = document.createElement('iframe');
          iframe.src = PLAYER_URL + "?token=" + encodeURIComponent(tokenInput);
          iframe.allow = `autoplay; encrypted-media; picture-in-picture; display-capture; fullscreen; speaker; clipboard-read; clipboard-write; magnetometer; gyroscope; accelerometer; payment`;
          iframe.allowFullscreen = true;
          playerWrap.appendChild(iframe);
          iframeAdded = true;
          iframe.addEventListener('load', () => { setTimeout(autoPlay, 2000); });
        }
      } else {
        if(iframeAdded){ playerWrap.innerHTML = ""; iframeAdded=false; }
        location.reload();
      }

    } catch(e){
      console.error("Erro ao verificar token:", e);
      if(!iframeAdded) location.reload();
    }
  }

  setInterval(checkToken, 1000);

})();
</script>

</body>
</html>
