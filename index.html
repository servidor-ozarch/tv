<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>SPORTV - Ao vivo</title>

<!-- Ícone da aba -->
<link rel="icon" type="image/png" href="favicon.png">
<link rel="apple-touch-icon" href="sportv.png">

<meta property="og:image" content="sportv.png">
<meta property="og:title" content="SPORTV - Ao vivo">
<meta property="og:description" content="Transmissão ao vivo">

<style>
  html, body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#000;
    font-family: Tahoma, "MS Sans Serif", system-ui, sans-serif;
    overflow:hidden;
    display:flex;
    flex-direction:column;
  }

  #playerWrap {
    position:relative;
    flex:1;
    z-index:100;
  }
  iframe {
    width:100%;
    height:100%;
    border:0;
  }

  /* Janela estilo Win95 */
  #denied {
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:200;
    background:rgba(0,0,0,0.8);
  }
  .window95 {
    background:#c0c0c0;
    width:380px;
    border:2px solid #fff;
    box-shadow:inset -2px -2px #808080, inset 2px 2px #fff, 3px 3px #000;
  }
  .titlebar {
    background:#000080;
    color:#fff;
    font-weight:bold;
    padding:4px 6px;
    font-size:13px;
  }
  .content {
    display:flex;
    gap:12px;
    padding:16px;
    font-size:13px;
    color:#000;
    background:#c0c0c0;
    border-top:2px solid #fff;
    box-shadow:inset -2px -2px #808080, inset 2px 2px #fff;
  }
  .content img {
    width:32px;
    height:32px;
    flex:0 0 32px;
  }
  .content h1 {
    margin:0 0 8px 0;
    font-size:18px;
    font-weight:bold;
  }
  .content p {
    margin:0;
    line-height:1.4;
  }

  footer {
    text-align:center;
    font-size:12px;
    padding:8px;
    color:#aaa;
    background:#000;
    z-index:150;
  }
</style>
</head>
<body>

<!-- Janela de mensagem -->
<div id="denied">
  <div class="window95" id="deniedContent">
    <div class="titlebar">Mensagem do sistema</div>
    <div class="content">
      <img src="warning.png" alt="!">
      <div>
        <h1>VERIFICANDO TOKEN...</h1>
        <p>Aguarde enquanto validamos seu acesso.</p>
      </div>
    </div>
  </div>
</div>

<!-- Player -->
<div id="playerWrap"></div>

<!-- Rodapé -->
<footer>©2025 Script Zeus - Por AMARAL</footer>

<script>
(async function () {
  const PLAYER_URL = "https://rdcplay.live/prime/sportv.html"; 
  const params = new URLSearchParams(window.location.search);
  const tokenInput = (params.get('token') || '').trim();

  const deniedEl = document.getElementById('denied');
  const deniedContent = document.getElementById('deniedContent');
  const playerWrap = document.getElementById('playerWrap');
  let iframeAdded = false;
  let tokenValido = false;

  // Mantém tela ligada
  let wakeLock = null;
  async function requestWakeLock() {
    try {
      if ('wakeLock' in navigator) {
        wakeLock = await navigator.wakeLock.request('screen');
        wakeLock.addEventListener('release', () => console.log('Wake Lock liberado'));
      }
    } catch (err) {
      console.error('Erro ao ativar Wake Lock:', err);
    }
  }
  requestWakeLock();
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') requestWakeLock();
  });

  // SHA1
  async function sha1(str) {
    const buf = new TextEncoder().encode(str);
    const hashBuffer = await crypto.subtle.digest('SHA-1', buf);
    return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
  }

  // Autoplay
  function autoPlay() {
    try {
      const iframe = document.querySelector('#playerWrap iframe');
      if (!iframe) return;
      const iframeDoc = iframe.contentDocument || (iframe.contentWindow && iframe.contentWindow.document);
      if (!iframeDoc) return;
      const playButton = iframeDoc.querySelector('[data-play]');
      if (playButton) playButton.click();
    } catch (e) {
      console.log('Autoplay não pôde acessar o iframe (cross-origin).', e);
    }
  }

  if (!tokenInput) {
    showDeniedMessage("ACESSO NEGADO", "Nenhum token foi informado.");
    return;
  }

  function showDeniedMessage(title, message) {
    deniedEl.style.display = 'flex';
    deniedContent.querySelector("h1").textContent = title;
    deniedContent.querySelector("p").textContent = message;
    if (iframeAdded) {
      playerWrap.innerHTML = "";
      iframeAdded = false;
    }
  }

  async function checkToken() {
    try {
      const FIREBASE_URL = "https://projeto-aplicativo-android-default-rtdb.firebaseio.com/Eliomar/token.json";
      const PROXY = "https://api.allorigins.win/raw?url=" + encodeURIComponent(FIREBASE_URL);

      const res = await fetch(PROXY + "?cachebust=" + Date.now());
      if (!res.ok) throw new Error("Falha ao ler token do Firebase");

      let tokenFromFirebase = await res.text();
      tokenFromFirebase = tokenFromFirebase.replace(/["\n\r]/g, "").trim();

      const tokenHash = await sha1(tokenInput);

      if (tokenInput === tokenFromFirebase || tokenHash === tokenFromFirebase) {
        // Token válido
        if (!tokenValido) {
          deniedEl.style.display = 'none';
          if (!iframeAdded) {
            const iframe = document.createElement('iframe');
            iframe.src = PLAYER_URL + "?token=" + encodeURIComponent(tokenInput);
            iframe.allow = "autoplay; encrypted-media; picture-in-picture; fullscreen";
            iframe.allowFullscreen = true;
            playerWrap.appendChild(iframe);
            iframeAdded = true;
            iframe.addEventListener('load', () => setTimeout(autoPlay, 0));
          }
          tokenValido = true;
        }
      } else {
        // Token inválido
        if (tokenValido || !iframeAdded) {
          showDeniedMessage("TOKEN INVÁLIDO", "Acompanhe os tokens gratuitos através do WhatsApp para os principais jogos da semana.");
          tokenValido = false;
        }
      }
    } catch (e) {
      console.error("Erro ao verificar token:", e);
      if (tokenValido || !iframeAdded) {
        showDeniedMessage("ERRO DE CONEXÃO", "Não foi possível validar seu acesso no momento.");
        tokenValido = false;
      }
    }
  }

  // Primeira verificação imediata
  checkToken();
  // Verificação periódica a cada 15 segundos
  setInterval(checkToken, 15000);

})();
</script>

</body>
</html>
