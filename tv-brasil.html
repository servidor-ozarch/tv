<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<!-- BLOQUEAR ZOOM -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>WebPlayer Pro</title>

<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        height: 100%;
        touch-action: manipulation;    
        overscroll-behavior: none;
    }

    #player {
        position: fixed;
        inset: 0;
        width: 100vw;
        height: 100vh;
        background: black;
        object-fit: contain;
    }

    #tapToUnmute, #loading, #erro {
        position: fixed;
        inset: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
        color: white;
        font-size: 22px;
        background: rgba(0,0,0,0.6);
        text-align: center;
    }

    #loading { font-size: 26px; }
    #erro { display: none; }
</style>
</head>

<body>

<div id="loading">Carregando stream...</div>
<div id="tapToUnmute">Toque para ativar o áudio</div>
<div id="erro">Falha ao carregar o vídeo<br><small>Tentando novamente...</small></div>

<video id="player" autoplay muted playsinline></video>

<!-- =================== ANTI-ZOOM COMPLETO =================== -->
<script>
document.addEventListener("gesturestart", e => e.preventDefault());
document.addEventListener("gesturechange", e => e.preventDefault());
document.addEventListener("gestureend", e => e.preventDefault());

let lastTouch = 0;
document.addEventListener("touchend", e => {
    const now = Date.now();
    if (now - lastTouch <= 300) e.preventDefault();
    lastTouch = now;
}, { passive: false });
</script>
<!-- ========================================================== -->

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
// ----------------------
// Ajuste dinâmico retrato/paisagem
// ----------------------
function ajustarPlayer() {
    const video = document.getElementById("player");
    const portrait = window.innerHeight > window.innerWidth;
    video.style.objectFit = portrait ? "cover" : "contain";
}
window.addEventListener("resize", ajustarPlayer);
window.addEventListener("orientationchange", ajustarPlayer);

// ----------------------
// Extração do M3U8 totalmente oculta
// ----------------------
async function extrairLink() {
    try {
        const req = await fetch("https://www.cxtv.com.br/tv-ao-vivo/tv-brasil");
        const html = await req.text();
        const achados = html.match(/https?:\/\/[^\s"'<>]+\.m3u8/gi);
        return achados ? achados[0] : null;
    } catch (e) {
        return null;
    }
}

// ----------------------
// Player + reconexão
// ----------------------
async function iniciarPlayer() {

    ajustarPlayer();

    let m3u8 = await extrairLink();
    if (!m3u8) {
        document.getElementById("erro").style.display = "flex";
        setTimeout(iniciarPlayer, 3000);
        return;
    }

    const video = document.getElementById("player");
    const loading = document.getElementById("loading");
    const erro = document.getElementById("erro");

    erro.style.display = "none";
    loading.style.display = "flex";

    if (Hls.isSupported()) {
        const hls = new Hls({
            maxBufferLength: 30,
            lowLatencyMode: true,
            enableWorker: true,
            fragLoadingRetryDelay: 1500,
            manifestLoadingRetryDelay: 1500
        });

        hls.loadSource(m3u8);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, () => loading.style.display = "none");

        hls.on(Hls.Events.ERROR, (e, data) => {
            if (data.fatal) {
                erro.style.display = "flex";
                setTimeout(iniciarPlayer, 2000);
            }
        });

    } else {
        video.src = m3u8;
        video.onloadeddata = () => loading.style.display = "none";
        video.onerror = () => {
            erro.style.display = "flex";
            setTimeout(iniciarPlayer, 2000);
        };
    }

    // Desbloqueio manual do áudio
    const overlay = document.getElementById("tapToUnmute");
    overlay.onclick = () => {
        video.muted = false;
        video.play();
        overlay.style.display = "none";
    };
}

iniciarPlayer();
</script>

</body>
</html>