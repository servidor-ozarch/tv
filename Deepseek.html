<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DeepSeek Chat Moderno</title>
<style>
/* Reset e body */
html, body {margin:0; padding:0; height:100%; font-family: 'Segoe UI', Roboto, sans-serif; background:#e5ddd5; overflow:hidden; -webkit-font-smoothing:antialiased;}
body {display:flex; justify-content:center; align-items:center;}

/* Canvas de fundo */
canvas#bgCanvas {position:fixed; inset:0; z-index:0; pointer-events:none; opacity:0.1;}

/* Container do chat */
.chat-container {width:100%; max-width:600px; height:90vh; background:#fff; border-radius:12px; display:flex; flex-direction:column; box-shadow:0 4px 12px rgba(0,0,0,0.2); overflow:hidden; z-index:1;}

/* Header */
.chat-header {background:#075e54; color:white; padding:16px; display:flex; align-items:center; gap:12px;}
.chat-header .logo {width:40px; height:40px; border-radius:50%; background:#25d366; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:18px; color:white;}
.chat-header .title {font-weight:600; font-size:16px;}

/* Mensagens */
.messages {flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:8px; background:#e5ddd5;}
.bubble {padding:10px 14px; border-radius:20px; max-width:75%; line-height:1.4; word-wrap:break-word; transition: all 0.2s;}
.user {align-self:flex-end; background:#dcf8c6; border-bottom-right-radius:4px;}
.ai {align-self:flex-start; background:#fff; border-bottom-left-radius:4px; box-shadow:0 1px 2px rgba(0,0,0,0.1);}

/* Input */
.input-bar {display:flex; padding:10px; gap:8px; border-top:1px solid #ccc; background:#f0f0f0;}
textarea {flex:1; border:none; outline:none; border-radius:20px; padding:10px; resize:none; background:#fff; box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);}
button {background:#075e54; color:white; border:none; border-radius:20px; padding:10px 16px; cursor:pointer; font-weight:600;}

/* Scrollbar */
.messages::-webkit-scrollbar {width:6px;}
.messages::-webkit-scrollbar-thumb {background:rgba(0,0,0,0.2); border-radius:3px;}
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="chat-container">
  <div class="chat-header">
    <div class="logo">DS</div>
    <div class="title">DeepSeek Chat</div>
  </div>
  <div class="messages" id="messages"></div>
  <div class="input-bar">
    <textarea id="prompt" rows="2" placeholder="Digite sua mensagem..."></textarea>
    <button id="send">Enviar</button>
  </div>
</div>

<script>
/* ================= CONFIGURAÇÃO API ================= */
const API_KEY = "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";
const API_URL = "https://openrouter.ai/api/v1/chat/completions";
const MODEL = "deepseek/deepseek-r1:free";
const TEMPERATURE = 0.7;
const MAX_TOKENS = 500;

/* Elementos */
const messagesEl = document.getElementById("messages");
const promptEl = document.getElementById("prompt");
const sendBtn = document.getElementById("send");

/* Histórico de mensagens no sessionStorage */
let chatHistory = JSON.parse(sessionStorage.getItem('deepseek_chat') || '[]');

/* Render inicial */
function renderHistory() {
  messagesEl.innerHTML = '';
  for(const m of chatHistory){
    addBubble(m.role, m.content, false);
  }
  messagesEl.scrollTop = messagesEl.scrollHeight;
}
renderHistory();

/* Adicionar bolha */
function addBubble(role, text, save=true){
  const div = document.createElement("div");
  div.className = "bubble " + role;
  div.innerText = text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  
  if(save){
    chatHistory.push({role, content:text});
    sessionStorage.setItem('deepseek_chat', JSON.stringify(chatHistory));
  }
}

/* Envio da mensagem */
sendBtn.addEventListener("click", sendPrompt);
promptEl.addEventListener("keydown", e => { if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); sendPrompt(); } });

async function sendPrompt(){
  const text = promptEl.value.trim();
  if(!text) return;
  addBubble("user", text);
  promptEl.value = "";
  addBubble("ai", "Respondendo...", false); // placeholder temporário

  /* Prepara o histórico completo */
  const messagesForAPI = [
    {role:"system", content:"Você é um assistente que responde estritamente em Português do Brasil."},
    ...chatHistory
  ];

  const payload = {
    model: MODEL,
    messages: messagesForAPI,
    temperature: TEMPERATURE,
    max_tokens: MAX_TOKENS
  };

  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer " + API_KEY
      },
      body: JSON.stringify(payload)
    });

    if(!res.ok) throw new Error(res.status + " " + res.statusText);

    const data = await res.json();
    const content = data.choices?.[0]?.message?.content || "Sem resposta";

    messagesEl.lastChild.innerText = content;
    chatHistory.push({role:"ai", content});
    sessionStorage.setItem('deepseek_chat', JSON.stringify(chatHistory));

  }catch(err){
    messagesEl.lastChild.innerText = "Erro: "+err.message;
  }
}

/* ================= WAKE LOCK ================= */
let wakeLock = null;
async function requestWakeLock(){
  try{
    if('wakeLock' in navigator){
      wakeLock = await navigator.wakeLock.request('screen');
      wakeLock.addEventListener('release', ()=>{ console.log('WakeLock liberado'); });
    }
  }catch(e){ console.warn('WakeLock erro', e); }
}
document.addEventListener('visibilitychange', async ()=>{
  if(document.visibilityState === 'visible' && !wakeLock) await requestWakeLock().catch(()=>{});
});
requestWakeLock().catch(()=>{});

/* ================= Canvas animado de fundo ================= */
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const particles = [];
for(let i=0;i<40;i++){
  particles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: 20 + Math.random()*60,
    vx: (Math.random()-0.5)*0.2, vy:(Math.random()-0.5)*0.2
  });
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const p of particles){
    p.x += p.vx; p.y += p.vy;
    if(p.x<-200) p.x = canvas.width+200;
    if(p.x>canvas.width+200) p.x = -200;
    if(p.y<-200) p.y = canvas.height+200;
    if(p.y>canvas.height+200) p.y = -200;
    const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r);
    g.addColorStop(0, 'rgba(124,58,237,0.12)');
    g.addColorStop(0.4, 'rgba(59,130,246,0.06)');
    g.addColorStop(1, 'rgba(3,6,23,0)');
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
